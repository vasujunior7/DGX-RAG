# 📊 Logs

This directory contains all application logs generated by the HackRX API. Logs are automatically created and rotated to maintain system performance while preserving important operational data.

## 📁 Structure

```
logs/
├── requests.log             # HTTP request/response logs
├── app.log                  # Application-specific logs
├── uvicorn.log             # Uvicorn server logs
├── uvicorn_access.log      # Uvicorn access logs
├── requests.log.1          # Rotated request logs (backup)
├── app.log.1               # Rotated app logs (backup)
└── ...                     # Additional rotated log files
```

## 📋 Log Files

### `requests.log`

**Purpose**: Detailed HTTP request and response logging  
**Content**: Complete request/response cycle information  
**Format**: JSON-structured logs for easy parsing

**Example Entry**:

```json
{
  "timestamp": "2025-07-25 22:37:26",
  "client_ip": "127.0.0.1",
  "method": "POST",
  "url": "http://localhost:8000/api/v1/hackrx/run",
  "status_code": 200,
  "process_time": 0.005,
  "user_agent": "python-requests/2.32.3",
  "content_type": "application/json",
  "authorization": "Bearer ***",
  "request_body": "{\"documents\": \"...\", \"questions\": [...]}"
}
```

**Logged Information**:

- ✅ Request timestamp
- ✅ Client IP address
- ✅ HTTP method and URL
- ✅ Response status code
- ✅ Processing time
- ✅ User agent string
- ✅ Content type
- ✅ Authorization (masked for security)
- ✅ Request body (with size limits)

### `app.log`

**Purpose**: Application business logic and error logging  
**Content**: Application events, errors, and operational messages  
**Format**: Standard log format with timestamps

**Example Entries**:

```
2025-07-25 22:37:26,085 - app - INFO - HackRX endpoint called with 2 questions
2025-07-25 22:37:26,085 - app - INFO - Document URL: https://example.com/test.pdf
2025-07-25 22:37:26,086 - app - INFO - Document loaded successfully
2025-07-25 22:37:26,087 - app - INFO - Successfully processed all 2 questions
2025-07-25 22:37:30,123 - app - ERROR - Error in hackrx_run: Invalid document format
```

**Logged Events**:

- ✅ Application startup/shutdown
- ✅ Endpoint access events
- ✅ Document processing steps
- ✅ Model initialization
- ✅ Error conditions
- ✅ Performance metrics

### `uvicorn.log`

**Purpose**: Uvicorn web server operational logs  
**Content**: Server lifecycle, configuration, and system events  
**Format**: Standard log format

**Example Entries**:

```
2025-07-25 22:36:06,764 - uvicorn.error - INFO - Will watch for changes in these directories: ['C:\\Users\\saumi\\Desktop\\CODES\\HackRX']
2025-07-25 22:36:06,764 - uvicorn.error - INFO - Uvicorn running on http://0.0.0.0:8000 (Press CTRL+C to quit)
2025-07-25 22:36:07,207 - uvicorn.error - INFO - Started server process [22732]
2025-07-25 22:36:07,207 - uvicorn.error - INFO - Application startup complete.
```

**Logged Events**:

- ✅ Server startup/shutdown
- ✅ Port binding information
- ✅ Process IDs
- ✅ File watching (development mode)
- ✅ Application lifecycle events

### `uvicorn_access.log`

**Purpose**: Uvicorn HTTP access logs  
**Content**: Basic HTTP access information  
**Format**: Standard web server access log format

**Example Entries**:

```
2025-07-25 22:36:45,127 - INFO - 127.0.0.1:55431 - "GET / HTTP/1.1" 200
2025-07-25 22:37:26,088 - INFO - 127.0.0.1:55453 - "POST /api/v1/hackrx/run HTTP/1.1" 200
```

## 🔄 Log Rotation

### Rotation Policy

- **Max File Size**: 10MB per log file
- **Backup Count**: 5 backup files retained
- **Naming Convention**: `filename.log.1`, `filename.log.2`, etc.
- **Automatic**: Rotation happens automatically when size limit reached

### Rotation Benefits

- ✅ **Prevents disk space issues** from unlimited log growth
- ✅ **Maintains performance** by keeping active log files small
- ✅ **Preserves history** with backup files
- ✅ **Easy maintenance** with automatic cleanup

### Rotation Example

```
Original: requests.log (10MB - gets rotated)
After:    requests.log (new, empty)
          requests.log.1 (previous requests.log)
          requests.log.2 (older backup)
          ...
          requests.log.5 (oldest backup)
          (requests.log.6 gets deleted)
```

## 📊 Log Analysis

### Reading Recent Logs

```bash
# View latest 20 lines
tail -20 logs/requests.log

# Follow log in real-time
tail -f logs/app.log

# View all error messages
grep "ERROR" logs/app.log
```

### Parsing Request Logs

```python
import json

def parse_request_logs():
    with open('logs/requests.log', 'r') as f:
        for line in f:
            if 'REQUEST:' in line:
                json_part = line.split('REQUEST: ')[1]
                data = json.loads(json_part)
                print(f"{data['timestamp']} - {data['method']} {data['url']} - {data['status_code']}")

parse_request_logs()
```

### Performance Analysis

```python
import json
import statistics

def analyze_performance():
    times = []
    with open('logs/requests.log', 'r') as f:
        for line in f:
            if 'REQUEST:' in line:
                json_part = line.split('REQUEST: ')[1]
                data = json.loads(json_part)
                times.append(data['process_time'])

    if times:
        print(f"Average response time: {statistics.mean(times):.4f}s")
        print(f"Max response time: {max(times):.4f}s")
        print(f"Min response time: {min(times):.4f}s")

analyze_performance()
```

## 🔍 Monitoring

### Key Metrics to Monitor

**Response Times**:

- Average processing time per endpoint
- 95th percentile response times
- Slow requests (>1 second)

**Error Rates**:

- HTTP 4xx client errors
- HTTP 5xx server errors
- Application exceptions

**Usage Patterns**:

- Most frequently accessed endpoints
- Peak usage times
- Client IP distributions

### Alerting Suggestions

Set up monitoring for:

- **High error rates** (>5% 5xx errors)
- **Slow responses** (>2 seconds average)
- **Disk space** (log directory >80% full)
- **Application errors** (ERROR level logs)

## 🔧 Configuration

### Log Levels

Current configuration:

- **INFO**: Normal operations, requests
- **WARNING**: Potential issues
- **ERROR**: Error conditions
- **DEBUG**: Detailed debugging (disabled in production)

### Modifying Log Settings

Edit `utils/logging_config.py`:

```python
# Change rotation settings
maxBytes = 50*1024*1024  # 50MB instead of 10MB
backupCount = 10         # 10 backups instead of 5

# Change log format
formatter = logging.Formatter(
    '%(asctime)s - %(name)s - %(levelname)s - %(funcName)s:%(lineno)d - %(message)s'
)

# Change log level
logger.setLevel(logging.DEBUG)  # Include debug messages
```

## 🔒 Security Considerations

### Sensitive Data Protection

- **API Keys**: Automatically masked as "Bearer \*\*\*"
- **Passwords**: Never logged
- **Personal Data**: Avoid logging personal information
- **Request Bodies**: Large bodies truncated

### Log Access

- **File Permissions**: Ensure appropriate read/write permissions
- **Log Retention**: Consider regulatory requirements
- **Secure Storage**: Protect log files from unauthorized access

### Privacy

- **IP Addresses**: Consider privacy implications
- **User Data**: Minimize personal data in logs
- **Compliance**: Follow data protection regulations

## 🧹 Maintenance

### Regular Tasks

**Daily**:

- Monitor disk space usage
- Check for error spikes
- Review performance metrics

**Weekly**:

- Analyze usage patterns
- Review log retention
- Check rotation is working

**Monthly**:

- Archive old logs if needed
- Review log configuration
- Update monitoring thresholds

### Cleanup Scripts

```bash
# Remove logs older than 30 days
find logs/ -name "*.log.*" -mtime +30 -delete

# Compress old logs
gzip logs/*.log.[2-5]

# Check disk usage
du -sh logs/
```

## 📋 Best Practices

### Logging

- **Log meaningful events** - Don't over-log or under-log
- **Use appropriate levels** - INFO for normal ops, ERROR for problems
- **Include context** - Add relevant information for debugging
- **Structure data** - Use JSON for request logs

### Monitoring

- **Set up alerts** - Monitor for errors and performance issues
- **Regular review** - Check logs regularly for patterns
- **Automate analysis** - Use scripts for common analysis tasks

### Security

- **Protect sensitive data** - Never log credentials or personal info
- **Secure access** - Limit who can read log files
- **Retention policy** - Don't keep logs forever

---

**Comprehensive Logging System for the HackRX API**
